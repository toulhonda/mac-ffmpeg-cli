# 要求仕様書 (requirements.md) - v2.0

## 1. 概要

本ツールは、FFmpeg を利用して音声ファイルを MP4 形式に変換するコマンドラインインターフェース (CLI) です。ユーザーは個別の音声ファイルまたは指定したディレクトリ内の音声ファイルを一括で変換できます。シェルスクリプトとして実装され、macOSでの利用を想定しています。

## 2. 機能要件

### 2.1. コマンドライン操作

ユーザーはメニュー形式で以下の操作を選択できること。

1.  **Homebrew のアップデート**: Homebrew のパッケージリストを更新し、インストール済みのパッケージをアップグレードする。
2.  **個別ファイルの変換**: 指定した音声ファイル (WAV, MP3, M4A) を MP4 形式に変換する。
3.  **ディレクトリ内ファイルの一括変換**: 指定したディレクトリ内のすべての対応音声ファイルを MP4 形式に一括変換する。
4.  **終了**: アプリケーションを終了する。

### 2.2. Homebrew のアップデート (オプション 1)

  * `brew update && brew upgrade` コマンドを実行すること。
  * コマンドの実行結果を標準出力に表示すること。

### 2.3. 個別ファイルの変換 (オプション 2)

  * ユーザーに変換したい音声ファイルのパスを入力させること。
  * 入力されたファイルが **WAV**, **MP3**, **M4A**, **WMA** のいずれかであることを確認すること.
  * 以下の FFmpeg コマンドを参考に、MP4 ファイルを生成すること。
    ```bash
    ffmpeg -y -f lavfi -i color=black:s=1280x720:r=25 -i "(入力ファイル名)" -shortest -c:v libx264 -c:a aac -b:a 192k -pix_fmt yuv420p -v quiet -stats "(出力ファイル名.mp4)"
    ```
      * `出力ファイル名.mp4` は入力ファイル名と同じ basename を持つこと。
  * **FFmpeg の変換進捗をリアルタイムで表示すること (`-v quiet -stats` オプションを利用)。**

### 2.4. ディレクトリ内ファイルの一括変換 (オプション 3)

  * ユーザーに変換対象のディレクトリパスを入力させること。
  * 指定されたディレクトリ内に存在する **WAV**, **MP3**, **M4A**, **WMA** ファイルをすべて検出すること。
  * **変換開始前に、対象となるファイルの総数を表示すること。**
  * **変換中に、現在の処理状況（例: "X/Y ファイルを処理中"）を表示すること。**
  * 検出された各ファイルに対し、個別ファイルの変換 (2.3) と同じ FFmpeg コマンドを実行すること。
  * 変換が完了したファイルの数と、失敗したファイルの数を最後に表示すること。

### 2.5. エラーハンドリング

  * 無効なファイルパスやディレクトリパスが入力された場合、ユーザーに再入力を促すこと。
  * FFmpeg コマンドの実行に失敗した場合、エラーメッセージを表示し、処理を継続すること。
  * 対応していないファイル形式が入力された場合、その旨をユーザーに通知すること。
  * `brew` や `ffmpeg` コマンドが存在しない場合は、エラーメッセージを表示すること。

### 2.6. ユーザーインターフェース (UI)

  * 全ての表示メッセージは**日本語**とすること。
  * 操作メニューは番号で選択できるようにすること。
  * プロンプトは明確で分かりやすいものとすること。
  * **起動時にスプラッシュスクリーンとして、アスキーアートのロゴを表示すること。**

## 3. 非機能要件

### 3.1. 動作環境

  * macOS (Homebrew および FFmpeg がインストールされていること)

### 3.2. 依存関係

  * **FFmpeg**: Homebrew 経由でインストールされていることを前提とする。
  * **Bash**: macOS標準のシェルで動作すること。

## 4. その他

  * 本ツールは単一のシェルスクリプト (`mac-ffmpeg.sh`) として実装すること。
  * 外部ライブラリの利用は行わない。
